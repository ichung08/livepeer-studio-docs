import CodeBlock from "@theme/CodeBlock";
import CodeBlockTabs from "@site/src/components/CodeBlockTabs";
import CodeBlockTabItem from "@site/src/components/CodeBlockTabItem";

# Upload a Video

This guide provides you the instructions to upload a video from the Livepeer 
Studio Dashboard or through the Livepeer API.

## Technical Preparation

Before getting started, you will need to meet the following dependencies for 
working with the On Demand feature:

- [A Livepeer Studio account](https://livepeer.studio/login)
- Install [Node.js](https://nodejs.org/en/)
- Access to the [API Reference](https://docs.livepeer.studio/references)
- An [API Key](https://docs.livepeer.studio/guides/livestreaming/api-key) to call the VOD API
    - Note: Calling the API from the frontend requires an API key with CORS access allowed

Throughout this guide you'll see a few terms mentioned multiple times, asset and task:
- **Asset**: an object that represents a file
- **Task**: an action taken on the file

## Dashboard

The Livepeer Studio Dashboard is a frontend interface that enables users to interact 
with Livepeer’s features without any code. Using the Dashboard you can upload a video 
quickly just by uploading it to Livepeer.

### Step 1: [Log in](https://livepeer.studio/login) to the Livepeer Studio Dashboard

![Log in page](/../static/guides/Dashboard-1.png)

### Step 2: Navigate to the [Assets page](https://livepeer.studio/dashboard/assets)

![Assets page](/../static/guides/Dashboard-2.png)

### Step 3: Create a new video on demand asset 
Create a new asset by clicking create asset. When naming your asset, enter a unique 
name and include URL-compatible characters. Then enter the URL of the file you want 
to create an asset of. 
- Note: the URL must end in .mp4

![Assets page](/../static/guides/Dashboard-3.png)

![Log in page](/../static/guides/Dashboard-4.png)

### Step 4: Share, view or download your asset
After creating your new asset, a download URL will be generated. You can share, 
view or download the video using this URL.

![Log in page](/../static/guides/Dashboard-5.png)

## API

The Video-on-Demand (VOD) API allows you to send video files to Livepeer and get them 
ready for optimized playback. Those videos can be provided either by you (static content) 
or your users, given your application offers an interface for them to do so.

### Caveats
- Files are currently limited to 1GB in size. Any files greater than that will likely error 
out during the upload or processing steps.
- Only MP4 files encoded with H.264 and AAC are supported

### Uploading via URL

When using the upload via URL method:
- Provide the name of the asset
- Provide the URL of the asset that should be imported

#### Step 1: Upload asset by URL
To upload the asset to the Livepeer network, you'll need to make a POST request 
and include the URL of the asset to be uploaded. 

#### Request

<CodeBlockTabs>
<CodeBlockTabItem value="typescript" label="Typescript">

```js
const axios = require('axios');
const fs = require('fs');
var url = "https://example.com";

const uploadAssetURL = async () => {
    const response = await axios.post("https://livepeer.studio/api/asset/import", {
        headers: {
            'Authorization': `Bearer ${process.env.LP_API_KEY}`,
            'Content-Type': 'application/json'
        },
        data: JSON.stringify({
            "url": "$EXTERNAL_URL",
            "name": "Example name"
        })
    }

    console.log(JSON.stringify(response.data))
)};
```

</CodeBlockTabItem>
</CodeBlockTabs>

#### Response

```json
{
  "asset": {
    "id": "87289307-b60f-432b-984a-8ede174fa152",
    "playbackId": "8728n2iaziowj67d",
    "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
    "createdAt": 1652894665364,
    "status": "waiting",
    "name": "Waterfall"
  },
  "task": {
    "id": "77588656-ab08-4dd2-a244-0ff8df7ce664",
    "createdAt": 1652894665451,
    "type": "import",
    "outputAssetId": "87289307-b60f-432b-984a-8ede174fa152",
    "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
    "params": {
      "import": {
        "url": "https://www.pexels.com/video/6394054/download/"
      }
    },
    "status": {
      "phase": "pending",
      "updatedAt": 1652894665451
    }
  }
}
```

#### Step 2: Check the upload status
After uploading your asset, get the `asset.id` from the response object of the POST request. The `asset.id`
represents the status of your upload. When `asset.status == "ready"` that means the asset has 
finished uploading and will be ready for playback.

#### Request

<CodeBlockTabs>
<CodeBlockTabItem value="typescript" label="Typescript">

```js
const getAsset = async () => {
    const response = await axios.get("https://livepeer.studio/api/task/$ASSET_ID", {
        headers: {
            Authorization: `Bearer ${process.env.LP_API_KEY}`,
        },
    })
    
    console.log(JSON.stringify(response.data));
};
```

</CodeBlockTabItem>
</CodeBlockTabs>

#### Response

```json
{
  "id": "87289307-b60f-432b-984a-8ede174fa152",
  "hash": [
    {
      "hash": "6dad0a8e7a92d537c6305fe6ae1e1881",
      "algorithm": "md5"
    },
    {
      "hash": "6132f4e43472b56b4047b7ad018147056c0c2dba9306cd04504e9c8208e72257",
      "algorithm": "sha256"
    }
  ],
  "name": "Waterfall",
  "size": 32407849,
  "status": "ready",
  "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
  "createdAt": 1652894665364,
  "updatedAt": 1652894675275,
  "videoSpec": {
    "format": "mp4",
    "tracks": [
      {
        "fps": 23.976023976023978,
        "type": "video",
        "codec": "h264",
        "width": 4096,
        "height": 2048,
        "bitrate": 21324821,
        "duration": 12.011667,
        "pixelFormat": "yuv420p"
      },
      {
        "type": "audio",
        "codec": "aac",
        "bitrate": 253375,
        "channels": 2,
        "duration": 12.031667,
        "sampleRate": 48000
      }
    ],
    "duration": 12.031667
  },
  "playbackId": "8728n2iaziowj67d",
  "playbackUrl": "https://livepeercdn.com/recordings/e605988e-e8d3-4e14-b5b0-10b01ff94a8b/index.m3u8",
  "downloadUrl": "https://livepeercdn.com/asset/8728n2iaziowj67d/video"
}
```

### Uploading Locally

#### Step 1: Generate upload URL

To upload the asset to the Livepeer network locally, you'll need to make a POST request 
to generate an upload URL.

#### Request

<CodeBlockTabs>
<CodeBlockTabItem value="typescript" label="Typescript">

```js
const uploadAsset = async () => {
  const response = await axios.post(
    "https://livepeer.studio/api/asset/request-upload",
    {
      headers: {
        Authorization: `Bearer ${process.env.LP_API_KEY}`,
        "Content-Type": "application/json",
      },
      data: JSON.stringify({
        name: "Example name",
      }),
    }
  );
  console.log(JSON.stringify(response.data));
};
```

</CodeBlockTabItem>
</CodeBlockTabs>

#### Response

```json
{
  "url": "https://origin.livepeer.studio/api/asset/upload/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwcmVzaWduZWRVcmwiOiJodHRwczovL3N0b3JhZ2UuZ29vZ2xlYXBpcy5jb20vbHAtdXMtdm9kLWNvbS9kaXJlY3RVcGxvYWQvNGMyMWs3ejJ0amNkZzh3dC9zb3VyY2U_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ29udGVudC1TaGEyNTY9VU5TSUdORUQtUEFZTE9BRCZYLUFtei1DcmVkZW50aWFsPUdPT0cxRVlVTldOVjZSWUlLNTQySFdBM1JMN1JCN0pVT0VRM1lMMjNRWUI2Q0hQRzVITzJRQzMzTUpWVVklMkYyMDIyMDUxOCUyRnVzJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDIyMDUxOFQxOTIyMDVaJlgtQW16LUV4cGlyZXM9OTAwJlgtQW16LVNpZ25hdHVyZT0wZWJmNmMwNWFlZTA2ZGVhOGZmM2U1MzNmNjMxZjk1ZTY3M2I4ZWRiOTI3MWJlOWQzYjdhZWQ4YjI1YTUzZTM3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZ4LWlkPVB1dE9iamVjdCIsImF1ZCI6Imh0dHBzOi8vbGl2ZXBlZXIuY29tIiwiaWF0IjoxNjUyOTAxNzI1fQ.2wSQMC3s6QFFkmyhQZuecbQF2R8E_j3VGTg9tblc0Dc",
  "asset": {
    "id": "4c21895e-2488-4c0a-9377-3369ff586ddd",
    "playbackId": "4c21k7z2tjcdg8wt",
    "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
    "createdAt": 1652901725324,
    "status": "waiting",
    "name": "Waterfall"
  },
  "task": {
    "id": "58a9b4dc-89d8-40f5-8372-cacaec49024b",
    "createdAt": 1652901725741,
    "type": "import",
    "outputAssetId": "4c21895e-2488-4c0a-9377-3369ff586ddd",
    "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
    "params": {
      "import": {
        "uploadedObjectKey": "directUpload/4c21k7z2tjcdg8wt/source"
      }
    },
    "status": {
      "phase": "pending",
      "updatedAt": 1652901725741
    }
  }
}
```

#### Step 2: Upload your video to the URL
Get the `"url": "https://origin.livepeer.studio/api/assets/…"` from the response object. 
Using the URL generated, upload your video with a PUT request. 

#### Request

<CodeBlockTabs>
<CodeBlockTabItem value="typescript" label="Typescript">

```js
const uploadAsset = async () => {
    const response = await axios.put("${url}", {
        headers: {
            Authorization: `Bearer ${process.env.LP_API_KEY}`
            "Content-Type": "video/mp4"
        },
        data: fs.createReadStream(path)
    });

    console.log(JSON.stringify(response.data));
};
```

</CodeBlockTabItem>
</CodeBlockTabs>

#### Response

```json
{
  "id": "87289307-b60f-432b-984a-8ede174fa152",
  "hash": [
    {
      "hash": "6dad0a8e7a92d537c6305fe6ae1e1881",
      "algorithm": "md5"
    },
    {
      "hash": "6132f4e43472b56b4047b7ad018147056c0c2dba9306cd04504e9c8208e72257",
      "algorithm": "sha256"
    }
  ],
  "name": "Waterfall",
  "size": 32407849,
  "status": "waiting",
  "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
  "createdAt": 1652894665364,
  "updatedAt": 1652894675275,
  "videoSpec": {
    "format": "mp4",
    "tracks": [
      {
        "fps": 23.976023976023978,
        "type": "video",
        "codec": "h264",
        "width": 4096,
        "height": 2048,
        "bitrate": 21324821,
        "duration": 12.011667,
        "pixelFormat": "yuv420p"
      },
      {
        "type": "audio",
        "codec": "aac",
        "bitrate": 253375,
        "channels": 2,
        "duration": 12.031667,
        "sampleRate": 48000
      }
    ],
    "duration": 12.031667
  },
  "playbackId": "8728n2iaziowj67d",
  "playbackUrl": "https://livepeercdn.com/recordings/e605988e-e8d3-4e14-b5b0-10b01ff94a8b/index.m3u8",
  "downloadUrl": "https://livepeercdn.com/asset/8728n2iaziowj67d/video"
}
```

#### Step 3: Check the upload status
After uploading your asset, get the `asset.id` from the response object of the POST request. The `asset.id`
represents the status of your upload. When `asset.status == "ready"` that means the asset has 
finished uploading and will be ready for playback.

#### Request

<CodeBlockTabs>
<CodeBlockTabItem value="typescript" label="Typescript">

```js
const getAsset = async () => {
    const response = await axios.get("https://livepeer.studio/api/task/$ASSET_ID", {
        headers: {
            Authorization: `Bearer ${process.env.LP_API_KEY}`,
        },
    })
    
    console.log(JSON.stringify(response.data));
};
```

</CodeBlockTabItem>
</CodeBlockTabs>

#### Response

```json
{
  "id": "87289307-b60f-432b-984a-8ede174fa152",
  "hash": [
    {
      "hash": "6dad0a8e7a92d537c6305fe6ae1e1881",
      "algorithm": "md5"
    },
    {
      "hash": "6132f4e43472b56b4047b7ad018147056c0c2dba9306cd04504e9c8208e72257",
      "algorithm": "sha256"
    }
  ],
  "name": "Waterfall",
  "size": 32407849,
  "status": "ready",
  "userId": "eada599f-3d58-499b-ba24-c7f3faf988de",
  "createdAt": 1652894665364,
  "updatedAt": 1652894675275,
  "videoSpec": {
    "format": "mp4",
    "tracks": [
      {
        "fps": 23.976023976023978,
        "type": "video",
        "codec": "h264",
        "width": 4096,
        "height": 2048,
        "bitrate": 21324821,
        "duration": 12.011667,
        "pixelFormat": "yuv420p"
      },
      {
        "type": "audio",
        "codec": "aac",
        "bitrate": 253375,
        "channels": 2,
        "duration": 12.031667,
        "sampleRate": 48000
      }
    ],
    "duration": 12.031667
  },
  "playbackId": "8728n2iaziowj67d",
  "playbackUrl": "https://livepeercdn.com/recordings/e605988e-e8d3-4e14-b5b0-10b01ff94a8b/index.m3u8",
  "downloadUrl": "https://livepeercdn.com/asset/8728n2iaziowj67d/video"
}
```
